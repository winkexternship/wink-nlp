var rgxDouble=/(bb|dd|ff|gg|mm|nn|pp|rr|tt)$/,rgxSFXsses=/(.+)(sses)$/,rgxSFXiedORies2=/(.{2,})(ied|ies)$/,rgxSFXiedORies1=/(.{1})(ied|ies)$/,rgxSFXusORss=/(.+)(us|ss)$/,rgxSFXs=/(.+)(s)$/,rgxSFXeedlyOReed=/(.*)(eedly|eed)$/,rgxSFXedORedlyORinglyORing=/([aeiouy].*)(ed|edly|ingly|ing)$/,rgxSFXatORblORiz=/(at|bl|iz)$/,rgxSFXyOR3=/(.+[^aeiouy])([y3])$/,rgxSFXstep2=/(ization|ational|fulness|ousness|iveness|tional|biliti|lessli|entli|ation|alism|aliti|ousli|iviti|fulli|enci|anci|abli|izer|ator|alli|bli|ogi|li)$/,rgxSFXstep2WithReplacements=[{rgx:/ational$/,replacement:"ate"},{rgx:/ization$/,replacement:"ize"},{rgx:/fulness$/,replacement:"ful"},{rgx:/ousness$/,replacement:"ous"},{rgx:/iveness$/,replacement:"ive"},{rgx:/tional$/,replacement:"tion"},{rgx:/biliti$/,replacement:"ble"},{rgx:/lessli$/,replacement:"less"},{rgx:/iviti$/,replacement:"ive"},{rgx:/ousli$/,replacement:"ous"},{rgx:/ation$/,replacement:"ate"},{rgx:/entli$/,replacement:"ent"},{rgx:/(.*)(alism|aliti)$/,replacement:"$1al"},{rgx:/fulli$/,replacement:"ful"},{rgx:/alli$/,replacement:"al"},{rgx:/ator$/,replacement:"ate"},{rgx:/izer$/,replacement:"ize"},{rgx:/enci$/,replacement:"ence"},{rgx:/anci$/,replacement:"ance"},{rgx:/abli$/,replacement:"able"},{rgx:/bli$/,replacement:"ble"},{rgx:/(.*)(l)(ogi)$/,replacement:"$1$2og"},{rgx:/(.*)([cdeghkmnrt])(li)$/,replacement:"$1$2"}],rgxSFXstep3=/(ational|tional|alize|icate|iciti|ative|ical|ness|ful)$/,rgxSFXstep3WithReplacements=[{rgx:/ational$/,replacement:"ate"},{rgx:/tional$/,replacement:"tion"},{rgx:/alize$/,replacement:"al"},{rgx:/(.*)(icate|iciti|ical)$/,replacement:"$1ic"},{rgx:/(ness|ful)$/,replacement:""}],rgxSFXstep4=/(ement|ance|ence|able|ible|ment|ant|ent|ism|ate|iti|ous|ive|ize|al|er|ic)$/,rgxSFXstep4Full=/(ement|ance|ence|able|ible|ment|ant|ent|ism|ate|iti|ous|ive|ize|ion|al|er|ic)$/,rgxSFXstep4ion=/(.*)(s|t)(ion)$/,exceptions1=Object.create(null);exceptions1.skis="ski",exceptions1.skies="sky",exceptions1.dying="die",exceptions1.lying="lie",exceptions1.tying="tie",exceptions1.idly="idl",exceptions1.gently="gentl",exceptions1.ugly="ugli",exceptions1.early="earli",exceptions1.only="onli",exceptions1.singly="singl",exceptions1.sky="sky",exceptions1.news="news",exceptions1.atlas="atlas",exceptions1.cosmos="cosmos",exceptions1.bias="bias",exceptions1.andes="andes";var rgxException2=/^(inning|outing|canning|herring|proceed|exceed|succeed|earring)$/,prelude=function(s){return s.replace(/^y/,"3").replace(/([aeiou])y/,"$13").replace(/\’s$|\'s$/,"").replace(/s\’$|s\'$/,"").replace(/[\’\']$/,"")},isShort=function(s){return/[^aeiouy][aeiouy][^aeiouywx3]$/.test(s)||/^[aeiouy][^aeiouy]{0,1}$/.test(s)},markRegions=function(s){var m1,m2,rgxRegions=/[aeiouy]+([^aeiouy]{1}.+)/;return(m1=rgxRegions.exec(s))?(m1=m1[1].slice(1),m1=/^(gener|commun|arsen)/.test(s)?s.replace(/^(gener|commun|arsen)(.*)/,"$2"):m1,(m2=rgxRegions.exec(m1))?{r1:m1,r2:m2=m2[1].slice(1)}:{r1:m1,r2:""}):{r1:"",r2:""}},step1a=function(s){var wordPart;return rgxSFXsses.test(s)?s.replace(rgxSFXsses,"$1ss"):rgxSFXiedORies2.test(s)?s.replace(rgxSFXiedORies2,"$1i"):rgxSFXiedORies1.test(s)?s.replace(rgxSFXiedORies1,"$1ie"):rgxSFXusORss.test(s)?s:(wordPart=s.replace(rgxSFXs,"$1"),/[aeiuouy](.+)$/.test(wordPart)?s.replace(rgxSFXs,"$1"):s)},step1b=function(s){var sd,rgn=markRegions(s);return rgxSFXeedlyOReed.test(s)?rgxSFXeedlyOReed.test(rgn.r1)?s.replace(rgxSFXeedlyOReed,"$1ee"):s:rgxSFXedORedlyORinglyORing.test(s)?(sd=s.replace(rgxSFXedORedlyORinglyORing,"$1"),rgn=markRegions(sd),rgxSFXatORblORiz.test(sd)?sd+"e":rgxDouble.test(sd)?sd.replace(/.$/,""):isShort(sd)&&""===rgn.r1?sd+"e":sd):s},step1c=function(s){return s.replace(rgxSFXyOR3,"$1i")},step2=function(s){var i,imax,us,rgn=markRegions(s),match=s.match(rgxSFXstep2);if(match=null===match?"$$$$$":match[1],-1!==rgn.r1.indexOf(match))for(i=0,imax=rgxSFXstep2WithReplacements.length;i<imax;i+=1)if(us=s.replace(rgxSFXstep2WithReplacements[i].rgx,rgxSFXstep2WithReplacements[i].replacement),s!==us)return us;return s},step3=function(s){var i,imax,us,rgn=markRegions(s),match=s.match(rgxSFXstep3);if(match=null===match?"$$$$$":match[1],-1!==rgn.r1.indexOf(match)){for(i=0,imax=rgxSFXstep3WithReplacements.length;i<imax;i+=1)if(us=s.replace(rgxSFXstep3WithReplacements[i].rgx,rgxSFXstep3WithReplacements[i].replacement),s!==us)return us;if(/ative/.test(rgn.r2))return s.replace(/ative$/,"")}return s},step4=function(s){var rgn=markRegions(s),match=s.match(rgxSFXstep4Full);return match=null===match?"$$$$$":match[1],rgxSFXstep4Full.test(s)&&-1!==rgn.r2.indexOf(match)?rgxSFXstep4.test(s)?s.replace(rgxSFXstep4,""):rgxSFXstep4ion.test(s)?s.replace(rgxSFXstep4ion,"$1$2"):s:s},step5=function(s){var preceding,rgn;return rgn=markRegions(s),/e$/i.test(s)?(preceding=s.replace(/e$/,""),/e/.test(rgn.r2)||/e/.test(rgn.r1)&&!isShort(preceding)?preceding:s):/l$/.test(s)&&(rgn=markRegions(s)).r2&&/l$/.test(rgn.r2)?s.replace(/ll$/,"l"):s},stem=function(word){var str=word.toLowerCase();return str.length<3?str:exceptions1[str]?exceptions1[str]:(str=prelude(str),str=step1a(str),rgxException2.test(str)||(str=step1b(str),str=step1c(str),str=step2(str),str=step3(str),str=step4(str),str=step5(str)),str=str.replace(/3/g,"y"))};module.exports=stem;